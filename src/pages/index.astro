---
import Layout from '../layouts/Layout.astro';
---

<Layout title="From Thomas - Personal Website">
  <div class="h-screen h-[100dvh] relative overflow-hidden no-scroll-page">
    <!-- Background gradient overlay -->
    <div 
      id="bg-gradient"
      class="absolute inset-0 z-0 transition-opacity duration-500 ease-in-out"
      style="background: color(display-p3 0.914 0.902 0.882)"
    ></div>
    
    <!-- Content -->
    <div class="relative z-10 h-full flex items-center justify-center">
      <div class="text-center">
        <!-- Number Pad -->
        <div class="space-y-6">
          <!-- Display -->
          <div id="password-display" class="font-hedvig-serif text-4xl text-[color(display-p3_0.533_0.518_0.494)] text-center tracking-widest min-h-[60px] flex items-center justify-center mb-8">
            
          </div>
          
          <!-- Number Pad Grid -->
          <div class="grid grid-cols-3 gap-4 max-w-xs mx-auto">
            <button class="number-btn" data-number="1">1</button>
            <button class="number-btn" data-number="2">2</button>
            <button class="number-btn" data-number="3">3</button>
            <button class="number-btn" data-number="4">4</button>
            <button class="number-btn" data-number="5">5</button>
            <button class="number-btn" data-number="6">6</button>
            <button class="number-btn" data-number="7">7</button>
            <button class="number-btn" data-number="8">8</button>
            <button class="number-btn" data-number="9">9</button>
            <button class="number-btn" data-number="0">0</button>
          </div>
          
          <div id="error-message" class="text-red-300 font-hedvig-serif text-sm hidden text-center">
            Incorrect password. Please try again.
          </div>
        </div>
      </div>
    </div>
  </div>
</Layout>

<style>
  /* Page-specific scroll prevention and iOS zoom prevention */
  .no-scroll-page {
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-text-size-adjust: none;
    -moz-text-size-adjust: none;
    -ms-text-size-adjust: none;
    text-size-adjust: none;
  }
  
  .number-btn {
    @apply w-16 h-16 rounded-full bg-black/[0.03] text-[color(display-p3_0.533_0.518_0.494)] font-hedvig-sans text-2xl transition-all duration-500 ease-out flex items-center justify-center hover:bg-black/[0.06] active:scale-90;
    /* Enhanced touch handling for iOS */
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    cursor: pointer;
    /* Ensure buttons are interactive */
    pointer-events: auto;
    /* Prevent text selection */
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }
  
  .number-btn:active {
    transform: scale(0.9) translateY(2px);
    transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .number-btn:hover {
    transform: translateY(-2px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Luxurious number display animation */
  #password-display {
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Luxurious background fade */
  #bg-gradient {
    transition: all 1.2s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Keypad fade out animation */
  .grid {
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }
</style>

<script>
  // Minimal iOS zoom prevention - only prevent pinch zoom on background
  (function() {
    // Only prevent pinch zoom on the page background, not on any interactive elements
    document.addEventListener('gesturestart', function (event) {
      // Only prevent on the page background, never on buttons or navigation
      if (event.target === document.body || event.target === document.documentElement) {
        event.preventDefault();
      }
    });
    
    document.addEventListener('gesturechange', function (event) {
      // Only prevent on the page background, never on buttons or navigation
      if (event.target === document.body || event.target === document.documentElement) {
        event.preventDefault();
      }
    });
    
    document.addEventListener('gestureend', function (event) {
      // Only prevent on the page background, never on buttons or navigation
      if (event.target === document.body || event.target === document.documentElement) {
        event.preventDefault();
      }
    });
  })();

  let currentPassword = '';
  const correctPassword = '10003';
  const passwordDisplay = document.getElementById('password-display');
  const errorMessage = document.getElementById('error-message');
  
  // Enhanced button functionality for iOS compatibility
  document.querySelectorAll('.number-btn').forEach(btn => {
    // Add both click and touch events for iOS compatibility
    btn.addEventListener('click', handleButtonClick);
    btn.addEventListener('touchstart', handleButtonClick, { passive: true });
    
    function handleButtonClick(event) {
      if (currentPassword.length < 5) {
        const number = this.getAttribute('data-number');
        currentPassword += number;
        
        // Debug logging
        console.log('Button clicked:', number, 'Current password:', currentPassword);
        
        updateDisplay();
        checkPassword();
      }
    }
  });
  
  // Update the display
  function updateDisplay() {
    console.log('Updating display with:', currentPassword);
    passwordDisplay.textContent = currentPassword;
    
    // Luxurious number appearance animation
    if (currentPassword.length > 0) {
      passwordDisplay.style.transform = 'scale(1.05)';
      passwordDisplay.style.opacity = '0.8';
      
      setTimeout(() => {
        passwordDisplay.style.transform = 'scale(1)';
        passwordDisplay.style.opacity = '1';
      }, 150);
    }
  }
  
  // Check password
  function checkPassword() {
    if (currentPassword === correctPassword) {
      // Luxurious success animation
      passwordDisplay.style.transform = 'scale(1.1)';
      passwordDisplay.style.opacity = '0.9';
      
      setTimeout(() => {
        // Fade out the keypad and numbers
        const keypad = document.querySelector('.grid');
        keypad.style.opacity = '0';
        keypad.style.transform = 'scale(0.95)';
        keypad.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
        
        // Fade out the password display
        passwordDisplay.style.opacity = '0';
        passwordDisplay.style.transform = 'scale(0.9)';
        
        // Correct password - luxurious fade out and redirect
        const bgGradient = document.getElementById('bg-gradient');
        bgGradient.style.opacity = '0';
        bgGradient.style.transform = 'scale(1.05)';
        
        setTimeout(() => {
          window.location.href = '/writing';
        }, 300);
      }, 200);
    } else if (currentPassword.length === 5) {
      // Wrong password - elegant error animation
      passwordDisplay.style.transform = 'scale(0.95)';
      passwordDisplay.style.opacity = '0.7';
      
      setTimeout(() => {
        passwordDisplay.style.transform = 'scale(1)';
        passwordDisplay.style.opacity = '1';
      }, 200);
      
      errorMessage.classList.remove('hidden');
      setTimeout(() => {
        currentPassword = '';
        updateDisplay();
        errorMessage.classList.add('hidden');
      }, 2000);
    }
  }
  
  // Keyboard support
  document.addEventListener('keydown', function(e) {
    if (e.key >= '0' && e.key <= '9') {
      if (currentPassword.length < 5) {
        currentPassword += e.key;
        updateDisplay();
        
        checkPassword();
      }
    } else if (e.key === 'Backspace') {
      if (currentPassword.length > 0) {
        currentPassword = currentPassword.slice(0, -1);
        updateDisplay();
      }
    }
  });
  
  // Debug: Log when page loads
  console.log('Page loaded, password display element:', passwordDisplay);
  console.log('Number buttons found:', document.querySelectorAll('.number-btn').length);
</script>
